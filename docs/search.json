[
  {
    "objectID": "diphtheria_coverage.html",
    "href": "diphtheria_coverage.html",
    "title": "Coverage of diphtheria",
    "section": "",
    "text": "library(tidyverse)\nlibrary(downloadthis)"
  },
  {
    "objectID": "diphtheria_coverage.html#coverage-data",
    "href": "diphtheria_coverage.html#coverage-data",
    "title": "Coverage of diphtheria",
    "section": "Coverage data",
    "text": "Coverage data\nDiphtheria vaccination coverage data for children aged 0–5 years\nThe data is separated into 2 files:\n\ndip_coverage_by_perma.csv: coverage data where each child’s location is determined by their permanent address (i.e., the address listed on official documents)\ndip_coverage_by_reg.csv: coverage data where each child’s location is based on the address where they registered for their first vaccination, typically their residential address.\n\n\n# load data\ncov_by_perma <- read.csv(\"data/dip_coverage_by_perma.csv\")\ncov_by_reg <- read.csv(\"data/dip_coverage_by_reg.csv\")\n\n\nData dictionary\n\n  \n    List of variables\n  \n\n\n\n\n\n\n\nVariable\nDescription\n\n\n\n\neval_date\nDate of evaluation (i.e. the date for which coverage is computed)\n\n\neval_year\nYear of evaluation (i.e. year in eval_date)\n\n\nprovince/province_reg\nProvince of residence, based on either the permanent address (province) or the registered vaccination address (province_reg).\n\nNote that we don’t have data where province_reg == \"Bình Định\"\n\n\nn_children\nNumber of children aged 0-5\n\n\ndose1\nNumber of children aged 0-5 who received at least 1 dose of vaccination\n\n\ndose2\nNumber of children aged 0-5 who received at least 2 dose of vaccination\n\n\ndose3\nNumber of children aged 0-5 who received at least 3 dose of vaccination\n\n\ndose1_on_schedule\nNumber of children aged 0-5 who received at least 1 dose on schedule\n\n\ndose2_on_schedule\nNumber of children aged 0-5 who received at least 2 dose on schedule\n\n\ndose3_on_schedule\nNumber of children aged 0-5 who received at least 3 dose on schedule\n\n\ndose_1_cov\nCoverage for 1 dose dose1/n_children\n\n\ndose_2_cov\nCoverage for 2 dose dose2/n_children\n\n\ndose_3_cov\nCoverage for 3 dose dose3/n_children\n\n\ndose_1_on_schedule\nCoverage for 1 dose on schedule dose1_on_schedule/n_children\n\n\ndose_2_on_schedule\nCoverage for 2 dose on schedule dose2_on_schedule/n_children\n\n\ndose_3_on_schedule\nCoverage for 3 dose on schedule dose3_on_schedule/n_children\n\n\n\n\n\n\n\n\n\n\nAdditional details regarding the computation process\n\n\n\n\n\n\nSchedule definition: I found 2 diphtheria vaccination schedules for newborns: either at 2-3-4 months old or 2-4-6 months old so I used the latter to be more inclusive.\nDenominator: n_children is computed by the total number of children born within the past 5 years (e.g. when eval_year = 2019, n_children is the sum of children born in 2014-2019.\nNumerator: number of vaccinated children is computed as follows:\n\nStep 1: Filter diphtheria vaccination records for children aged 0-5 at eval_year and only doses administered by the end of eval_year\n\ne.g. for eval_year = 2019 get records for children born in 2014-2019 and year of vaccination ≤ 2019\n\nStep 2: Count total doses of diphtheria per child received by the end of eval_year\nStep 3: Count number of children at different dosage level\n\n\n\n\n\n\n\nDownload data\nClick the button below to download dip_coverage_by_perma.csv\n\n\n Download diphtheria coverage by permanent address\n\n\nClick the button below to download dip_coverage_by_reg.csv\n\n\n Download diphtheria coverage by residential address\n\n\n\n\nData table\n\nBy residential addressBy permanent address\n\n\n\ncov_by_reg\n\n\n\n  \n\n\n\n\n\n\ncov_by_perma"
  },
  {
    "objectID": "diphtheria_coverage.html#visualization",
    "href": "diphtheria_coverage.html#visualization",
    "title": "Coverage of diphtheria",
    "section": "Visualization",
    "text": "Visualization\n\nGeo map\n\nvn = FileAttachment(\"data/gadm41_VNM_1_2.json\").json()\nvn_province = topojson.feature(vn, vn.objects.gadm41_VNM_1)\n\ncoverage_data_residential = FileAttachment(\"data/dip_coverage_by_reg.csv\").csv({typed: true})\ncoverage_data_perma = FileAttachment(\"data/dip_coverage_by_perma.csv\").csv({typed: true})\n// pathogen_province_select = coverage_data_province.filter(d => (d.pathogen === pathogenSelect))\n// pathogen_all_select = coverage_data_all.filter(d => (d.pathogen === pathogenSelect) & (d.yob > 2014 && d.yob < 2022))\n// pathogen_all_select_all = pathogen_all_select.filter(d => (d.vacage_group === \"all\"))\n// pathogen_all_select_oneyear = pathogen_all_select.filter(d => (d.vacage_group === \"(0-1y]\"))\nPlot = import(\"https://cdn.jsdelivr.net/npm/@observablehq/plot/+esm\")\n\nimport {addTooltips} from \"@mkfreeman/plot-tooltip\"\npercent = d3.format(\".2%\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nviewof yearSelect = Inputs.range([2019, 2023], \n                                 {label: \"Year:\", step: 1, value: 2019})\n                                 \nviewof address_type = Inputs.select([\"permanent\", \"residential\"], \n                                {label: \"Type of address:\"})          \n                             \nviewof dose_select = Inputs.select([\"≥1 dose\", \"≥2 doses\", \"≥3 doses\"], \n                      {label: \"Vaccination dose:\"}) \n\nviewof coverage_type = Inputs.select([\"all\", \"on schedule\"], {label: \"Type of coverage:\"})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncoverage_data = (address_type == \"permanent\") ? coverage_data_perma : coverage_data_residential\n\ndose_select_mapping = new Map([\n  [\"≥1 dose\", \"dose_1\"],\n  [\"≥2 doses\", \"dose_2\"],\n  [\"≥3 doses\", \"dose_3\"]\n])\n\ncoverage_type_mapping = new Map([\n  [\"all\", \"_cov\"],\n  [\"on schedule\", \"_on_schedule_cov\"],\n])\n\ncoverage_data_filter = coverage_data.filter(d => (d.eval_year === yearSelect))\n\nprovince_coverage_map = new Map(\n  coverage_data_filter.map(\n    (row => {\n      const province = address_type === \"permanent\" ? row.province : row.province_reg;\n\n      // select coverage column based on input\n      const coverage = row[\n                        dose_select_mapping.get(dose_select) + \n                        coverage_type_mapping.get(coverage_type)\n                        ]\n  \n      return [province, coverage];\n    })\n  )  \n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\naddTooltips( // Add tooltips\nPlot.plot({\n  //marginRight: 100,\n  //marginLeft: 100,\n  //marginTop: 0,\n  //marginBottom: 0,\n  height:600,\n  projection: { type: \"mercator\", domain: vn_province},\n  marks: [\n    Plot.geo(vn_province, {\n      fill: (d) => province_coverage_map.get(d.id),\n      title: (d) => `${d.id} \\n ${percent(province_coverage_map.get(d.id))}`\n      }),\n    Plot.geo(vn_province, {stroke: \"#fff\", strokeWidth: 0.5})\n  ],\n  color: {\n    scheme: \"spectral\", // Change color scheme\n    unknown: \"#ddd\", // Polygons with unknown broadband values are gray\n    type: \"linear\", // Linear scale for color progression\n    legend: true, // Add the legend\n    label: \"% of vaccine coverage\", // Update legend label\n    percent: true, // Convert value to a percent (from a proportion)\n    domain: [0, 100] // Update the value domain to span 0 to 100% access\n  }\n})\n)\n\n\n\n\n\n\n\n\nCoverage by province\n\nviewof province_select = Inputs.select(province_coverage_map.keys(), \n                      {label: \"Select province:\"}) \n                      \nviewof address_type2 = Inputs.select([\"permanent\", \"residential\"], \n                      {label: \"Type of address:\"})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncoverage_data2 = (address_type2 == \"permanent\") ? coverage_data_perma : coverage_data_residential\n\ncoverage_for_selected = coverage_data2.filter(d => (\n    (address_type2 == \"permanent\") ? \n    d.province === province_select : \n    d.province_reg === province_select\n  ))\n  \n// coverage_for_selected\n\naddTooltips( // Add tooltips\nPlot.plot({\n  title: \"Diphtheria coverage for \" + province_select,\n  x: {\n    label: \"Date\",\n    type: \"time\",\n    tickFormat: d3.utcFormat(\"%Y-%m-%d\")   // or \"%d %b %Y\"\n  },\n  y: {\n    label: \"Vaccine coverage (%)\",\n    domain: [0, 100],\n    percent: true,\n    grid: true,\n    tickFormat: d => d + \"%\"\n  },\n  marks: [\n    Plot.ruleY([0]),\n    // Coverage for at least 1 dose\n    Plot.line(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_1_cov\", stroke: \"red\", \n                  title: (d) => `≥1 dose`}),\n    Plot.dot(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_1_cov\", fill: \"red\", \n                  title: (d) => `≥1 dose`}),\n    // Coverage for at least 2 doses\n    Plot.line(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_2_cov\", stroke: \"blue\", \n                  title: (d) => `≥2 dose`}),\n    Plot.dot(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_2_cov\", fill: \"blue\", \n                  title: (d) => `≥2 dose`}),\n    // Coverage for at least 3 doses\n    Plot.line(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_3_cov\", stroke: \"purple\", \n                  title: (d) => `≥3 dose`}),\n    Plot.dot(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_3_cov\", fill: \"purple\", \n                  title: (d) => `≥3 dose`}),\n    // Coverage for at least 1 dose on schedule\n    Plot.line(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_1_on_schedule_cov\", \n    stroke: \"red\", strokeDasharray: [5, 5], title: (d) => `≥1 dose on schedule`}),\n    Plot.dot(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_1_on_schedule_cov\", \n    fill: \"red\", title: (d) => `≥1 dose on schedule`}),\n    // Coverage for at least 2 doses on schedule\n    Plot.line(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_2_on_schedule_cov\", \n    stroke: \"blue\", strokeDasharray: [5, 5], title: (d) => `≥2 dose on schedule`}),\n    Plot.dot(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_2_on_schedule_cov\", \n    fill: \"blue\", title: (d) => `≥2 dose on schedule`}),\n    // Coverage for at least 3 doses on schedule\n    Plot.line(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_3_on_schedule_cov\", \n    stroke: \"purple\",  strokeDasharray: [5, 5], title: (d) => `≥3 dose on schedule`}),\n    Plot.dot(coverage_for_selected, {x: d => new Date(d.eval_date), y: \"dose_3_on_schedule_cov\", \n    fill: \"purple\", title: (d) => `≥3 dose on schedule`})\n  ]\n})\n)"
  }
]